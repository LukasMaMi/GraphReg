---
title: "01-Simulation_Rand"
date: "Compiled at `r format(Sys.time(), '%Y-%m-%d %H:%M:%S', tz = 'UTC')` UTC"
output: github_document
params:
  name: "01-Simulation_Rand" # change if you rename file
---

```{r}
library(MASS)
library(pulsar)
library(Matrix)
library(igraph)
library(huge)

generator_rand <- function (n, p, graph, prob, vis = FALSE, verbose = TRUE, rho) 
{
    gcinfo(FALSE)
    if (verbose) 
        cat("Generating data from the multivariate normal distribution with the", 
            graph, "graph structure....")
  
    if (graph == "random") {
          prob = sqrt(prob/2) * (prob < 0.5) + (1 - sqrt(0.5 - 
              0.5 * prob)) * (prob >= 0.5)
      }

    theta = matrix(0, p, p)

    if (graph == "random") {
        if (is.null(rho)) 
            rho = 0.3
        tmp = matrix(runif(p^2, 0, 0.5), p, p)
        tmp = tmp + t(tmp)
        theta[tmp < prob] = 1
        rm(tmp)
        gc()
    }

    diag(theta) = 0
    omega = theta * rho
    diag(omega) = abs(min(eigen(omega)$values)) + 0.1
    sigma = cov2cor(solve(omega))
    diag(omega) <- 1
    x = mvrnorm(n, rep(0, p), sigma)
    sigmahat = cor(x)
    if (vis == TRUE) {
        fullfig = par(mfrow = c(2, 2), pty = "s", omi = c(0.3, 
            0.3, 0.3, 0.3), mai = c(0.3, 0.3, 0.3, 0.3))
        fullfig[1] = image(theta, col = gray.colors(256), main = "Adjacency Matrix")
        fullfig[2] = image(sigma, col = gray.colors(256), main = "Covariance Matrix")
        g = graph.adjacency(theta, mode = "undirected", diag = FALSE)
        layout.grid = layout.fruchterman.reingold(g)
        fullfig[3] = plot(g, layout = layout.grid, edge.color = "gray50", 
            vertex.color = "red", vertex.size = 3, vertex.label = NA, 
            main = "Graph Pattern")
        fullfig[4] = image(sigmahat, col = gray.colors(256), 
            main = "Empirical Matrix")
        rm(fullfig, g, layout.grid)
        gc()
    }
    if (verbose) 
        cat("done.\n")
    rm(vis, verbose)
    gc()
    sim = list(data = x, sigma = sigma, sigmahat = sigmahat, 
        omega = omega, theta = Matrix(theta, sparse = TRUE), 
        sparsity = sum(theta)/(p * (p - 1)), graph.type = graph) #Percentage of present edges in the graph (sum(theta)) divided by the total number of possible edges (p*(p-1))
    class(sim) = "sim"
    return(sim)
}
```

```{r}

```


```{r}

#Set Parameters
n <- 800 
p <- 40 

#Subsampled dataset size 
b = (floor(10*sqrt(n)))/n
#Number of Subsamples N
N = 20
#Probability for an edge to appear
prob = 3/(p-1)
3/p

set.seed(123)
ER <- generator_rand(n = n, p = p, prob = prob, graph = "random", rho = NULL, vis = TRUE)
ER_data <- ER$data

ER$omega
ER$theta
ER$sparsity

#Plot Adjacency Matrix
huge.plot(ER$theta)

#test
test <-  huge.generator(
      n = 800,
      d = 40,
      graph = "random",
      v = NULL,
      u = NULL,
      g = NULL,
      prob = NULL,
      vis = FALSE,
      verbose = TRUE
)

huge.plot(test$theta)
test$omega
test$sparsity


#Plot Adjacency Matrix
huge.plot(ER$theta)

#Lambda path
lambda_path  <- getLamPath(max = getMaxCov(hub_data), min = 0.01, len = 40)
lambda <- list(lambda=lambda_path)

true_graph <- as(ER$theta, "lMatrix")
true_cov <- ER$sigma


```

