---
title: "00-Simulation_Hub"
date: "Compiled at `r format(Sys.time(), '%Y-%m-%d %H:%M:%S', tz = 'UTC')` UTC"
output: github_document
params:
  name: "00-Simulation_Hub" # change if you rename file
---

# Simulations for Hub Graphs

## StARS Simulation (Liu et al. 2010)
* **Graph Structure:** The matrix rows/columns are partitioned into J equally-sized disjoint groups.
* **Groups:** Groups are denoted as V_1, V_2, ..., V_J such that their union forms the
set of all indices: V_1 U V_2 U ... U V_J = {1, ..., p}.
* **Pivotal Row:** Each of these groups V_k has an associated "pivotal" row denoted by k.
* **Size of Group:** The size of group V_1 is represented as s.
* **Omega (Precision Matrix) Structure:** For any index i in group V_k, the precision matrix elements Ω_ik and Ω_ki are set to value ρ. For any i not in V_k, the corresponding matrix elements are zero.
* **Experimental Details:** In Liu et al. (2010) the number of groups J is determined as J = floorfunct(p/s). The pivotal rows k are given by the sequence 1, s+1, 2s+1, ...
* **Rho value:** The value of ρ is given as ρ = (1/(s+1)) and in this context, s = 20, thus ρ = 1/21.
* **Number of Hubs g:** We have groups of size s = 20 for p = 40, therefore g = J = floor(p/s) .
* **Hub size:** According to Liu et al. (2010) s = 20.
* **Off-Diagonal Elements of Precision Matrix v:** Represent the strength of the connections in the graph. v =  ρ = (1/(s+1)) = 1/21.
* **Size of Subsampled Data Set:** According to Liu et al. (2010) b(n) = floor(10*sqrt(n))
* **Diagonal Elements of Precision Matrix Ω i.e. u:** According to Liu et al. (2010), the values of the diagonal elements of Ω are set to be one. This means that the variances of each individual variable are set to one. Therefore u = 1.
* **Number of Edges E:** E_l = p - g 
* **Sparsity Level:** Refers to the proportion of non-zero entries in the underlying true graphical model (i.e., the adjacency matrix or precision matrix). This gives an idea of how many edges (connections) are in the true graph compared to the total possible number of edges for a graph of that dimension.
* **Optimal Lambda:**  Determines the amount of penalty applied during the graphical model estimation process. A higher lambda will result in a sparser estimated graph (with fewer edges), while a lower lambda will allow for more edges. The optimal lambda is determined based on the stability of the graph structure across multiple subsamples.
* **Threshold beta:** The beta threshold is a user-defined value that decides the minimum proportion necessary for an edge to be considered "stable" and thus be included in the final graph. For instance, if the threshold is set to 0.1, it means an edge should be present in at least 10% of the subsamples to be considered stable.


##Simulate Synthetic Data
### 1) Hub Graph for n = 800 and p = 40
```{r}
library(huge)
library(pulsar)

#Set Parameters
n <- 800 
p <- 40 
s <- 20
v <- (1/(s+1))
u <- 1 
g <- floor(p/s) 
b = floor(10*sqrt(n))

set.seed(123)
hub1 <- huge.generator(n = n, d = p, graph = "hub", v = v, u = u, g = g, vis = TRUE)

hub1_data <- hub1$data

huge.plot(hub1$theta)
```

### 1.1) StARS for Hub Graph 1
```{r}
lams1  <- getLamPath(max = getMaxCov(hub1_data), min = 0.01, len = 40)
hugeargs1 <- list(lambda=lams1, verbose=FALSE)

out.p1 <- pulsar(
      hub1_data,
      fun = huge::huge,
      fargs = hugeargs1,
      criterion = c("stars"),
      thresh = 0.1,
      subsample.ratio = NULL,
      rep.num = 20,
      seed = NULL,
      lb.stars = FALSE,
      ub.stars = FALSE,
      ncores = 1,
      refit = TRUE
)

plot(out.p1)
lambda_opt_1 <- opt.index(out.p1, criterion = "stars")
lambda_opt_1

```

### 1.1.1) Plot for StARS for Hub Graph 1
```{r}

```


### 2) Hub Graph for n = 400 and p = 100
```{r}
library(huge)
library(pulsar)

#Set Parameters
n <- 400 
p <- 100
s <- 20
v <- (1/(s+1))
u <- 1 
g <- floor(p/s) 
b = floor(10*sqrt(n))

set.seed(123)
hub2 <- huge.generator(n = n, d = p, graph = "hub", v = v, u = u, g = g, vis = TRUE)

write.csv(hub2$data, "hub2_data.csv", row.names=FALSE)
hub2_data <- read.csv("hub2_data.csv")

huge.plot(hub2$theta)
```


### 3) Hub Graph for n = 200 and p = 200
```{r}
library(huge)
library(pulsar)

#Set Parameters
n <- 200 
p <- 200
s <- 20
v <- (1/(s+1))
u <- 1 
g <- floor(p/s) 
b = floor(10*sqrt(n))

set.seed(123)
hub3 <- huge.generator(n = n, d = p, graph = "hub", v = v, u = u, g = g, vis = TRUE)

write.csv(hub3$data, "hub3_data.csv", row.names=FALSE)
hub3_data <- read.csv("hub3_data.csv")

huge.plot(hub3$theta)
```


### 4) Hub Graph for n = 100 and p = 400
```{r}
library(huge)
library(pulsar)

#Set Parameters
n <- 100 
p <- 400
s <- 20
v <- (1/(s+1))
u <- 1 
g <- floor(p/s) 
b = floor(10*sqrt(n))

set.seed(123)
hub4 <- huge.generator(n = n, d = p, graph = "hub", v = v, u = u, g = g, vis = TRUE)

write.csv(hub4$data, "hub4_data.csv", row.names=FALSE)
hub4_data <- read.csv("hub4_data.csv")

huge.plot(hub4$theta)
```


















### Session info
```{r}
sessionInfo()
```

